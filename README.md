# WavMicBridge

把本地 **WAV 文件**“桥接”到**虚拟麦克风**里，让没有实体麦克风也能在游戏/语音软件中播放预录音。内置**声音库 + 全局热键**、**麦克风电平测试**、**托盘常驻**、**音量与循环**等功能，开箱即用。

> 适合场景：SCP:SL、语音联机、线上演示、语音应答等。  

---

## 功能特性

- **WAV→虚拟麦克风**：将选定 WAV 以 WASAPI 共享模式推送到输出设备（推荐 *CABLE Input*），游戏内选择麦克风 *CABLE Output* 接收。支持音量调节、单/双声道统一重采样至 48kHz、可选循环播放。
- **声音库（1..9 槽位）**：绑定 9 个 WAV，持久化到 `soundbank.json`；支持**双击播放**、**右键菜单**、**打开文件位置**、**清除绑定**。
- **全局热键**：`Ctrl + Alt + W + 1..9` 直接播放槽位；**按住 Shift** 触发时**强制重绑**；主键区与小键盘数字键均可。
- **麦克风测试**：选择输入设备，实时查看**电平峰值**（平滑处理，0–100 可视化）。
- **托盘驻留**：关闭窗口并不退出，左键托盘图标开合窗口；右键有“关于/退出”。
- **状态提示与设备探测**：自动提示是否检测到 *Virtual Audio Cable / VoiceMeeter*；缺失时回退到默认输出并给出指引。

---

## 界面总览

主窗体包含：文件选择区、输出设备下拉、播放/停止、循环、音量条、状态栏；下方为“**麦克风测试**”分组与“**声音库**”分组；托盘图标及菜单在后台常驻。

---

## 快速开始

### 运行环境
- Windows 10/11（需要 WASAPI）
- .NET（与解决方案一致的目标框架）
- 建议安装 **Virtual Audio Cable** 或 **VoiceMeeter**（非必需，但能把播放路由成“麦克风”）

### 构建与启动
1. 打开解决方案并还原依赖（使用的核心库包括 `NAudio` 与自研 `CMLS.CLogger`）。
2. 编译运行；首次启动会自动枚举音频设备与载入声音库。
3. 在**输出设备**选择 `CABLE Input`（若已安装 VAC），点击**播放**即可把 WAV 推到虚拟麦。

---

## 使用说明

### 播放一个 WAV
1. 点“**浏览…**”选择文件；  
2. 选择**输出设备**（推荐 `CABLE Input`）；  
3. 按“**播放**”，必要时勾选“**循环**”，并通过滑块调节音量。

### 声音库（1–9 槽位）
- **绑定**：在列表选中某槽位 → 右键“绑定/重新绑定…”。  
- **播放**：双击列表项，或在选中后右键“播放（与热键一致）”。  
- **保存位置**：`soundbank.json` 位于程序目录；支持“打开文件位置”。

### 全局热键
- `Ctrl + Alt + W + 1..9`：播放对应槽位；  
- **按住 Shift** 再触发 = **强制重绑**（弹窗选新 WAV 并立即播放）；  
- 支持主键区 `D1..D9` 与小键盘 `NumPad1..9`。

### 麦克风测试
- 选择**输入设备**（如 `CABLE Output`）→ 点击“**测试麦克风**”；  
- 观察电平条与数值（0–100），用于验证接入链路与噪声水平；再按按钮可停止测试。

### 托盘与后台
- 关闭窗口并不退出程序，会**隐藏到托盘**；  
- **左键**托盘图标可开合窗口；**右键**有“关于/退出”。

---

## 常见问题（FAQ）

**Q: 没检测到虚拟麦驱动怎么办？**  
A: 仍可播放到**系统默认输出设备**做本地预听；若需把声音作为“麦克风”给到游戏/语音软件，建议安装 *Virtual Audio Cable* 或 *VoiceMeeter* 并按“`CABLE Input` ←播放 | 游戏中选 `CABLE Output`”的方向配置。

**Q: 声音是立体声会怎样？**  
A: 程序会将双声道**混成单声道**，并统一重采样到 **48 kHz**，以提升兼容性。

**Q: 热键无效？**  
A: 低层键盘钩子通常不需要管理员权限，但某些环境中后台安全策略可能拦截；尝试以管理员运行或排查冲突软件。

**Q: 播放失败/报错？**  
A: 检查 WAV 是否存在、输出设备是否可用；查看状态栏与弹窗错误。如果设备列表为空，说明系统音频设备不可用或被独占。

---

## 日志

项目集成了 **CMLS.CLogger**：在窗体主流程中打印 Info/Debug/Warn/Error，便于定位设备枚举、热键触发、播放链路、托盘事件等问题。可按需调整 `LogLevel` 与输出适配器。

---

## 项目结构

